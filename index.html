<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta
      name="description"
      content="Conveyor Belt Sushi Animation Using Pure CSS"
    />
    <meta name="keywords" content="CSS, animation, SVG, sushi, conveyor, belt">
    <title>Conveyor Belt Sushi Animation</title>

    <meta property="og:title" content="Conveyor Belt Sushi Animation" />
    <meta property="og:description" content="I created this Conveyor Belt Sushi Animation using CSS animation, SVG icons, and JavaScript interactions!  " />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://harryli0088.github.io/conveyor-belt-sushi-animation/" />
    <meta property="og:image" content="https://harryli0088.github.io/conveyor-belt-sushi-animation/conveyor-belt-sushi-animation.png" />
  </head>
  <style>
    :root {
      --icon-size: 16vh;
      --offset-x: -15vh;
      --offset-y: 100vh;
    }

    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
      letter-spacing: 1px;
    }

    #app {
      position: relative;
      text-align: center;
      background: rgb(0,68,111);
      background: linear-gradient(135deg, rgba(0,68,111,1) 0%, rgba(0,39,64,1) 100%);
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }

    .conveyor-belt-animation {
      position: relative;
    }

    .icon {
      animation: conveyor-belt 30s linear;
      animation-iteration-count: infinite;
      position: absolute;
      top: 0;
      left: calc(-1 * var(--icon-size) / 2);
    }

    img {
      width: var(--icon-size);
      height: var(--icon-size);
      -webkit-user-drag: none;
      -khtml-user-drag: none;
      -moz-user-drag: none;
      -o-user-drag: none;
      user-drag: none;
      cursor: pointer;
      -webkit-tap-highlight-color: transparent;
      user-select: none;
    }
    img.hidden {
      opacity: 0;
      pointer-events: none;
    }

    .picked-up-plate-container {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%,-50%);
    }

    .picked-up-plate {
      transition: 0.5s;
    }


    @keyframes conveyor-belt {
      0% {
        transform: rotate(0) translateX( var(--offset-x)) translateY(calc(-1 * var(--offset-y))); /* start at the top, offset to the left */
      }
      41% { /* these percentages are hard-coded to the offset values at the top of the file to make the rotation look like it's moving at the same speed */
        transform: rotate(0) translateX( var(--offset-x)) translateY(0); /* move to the bottom of the conveyer belt */
      }
      59% {
        transform: rotate(-180deg) translateX( var(--offset-x)) translateY(0); /* rotate */
      }
      100% {
        transform: rotate(-180deg) translateX( var(--offset-x)) translateY( var(--offset-y)); /* move back to the top, offset to the right */
      }
    }

    #footer {
      position: absolute;
      bottom: 0;
      right: 0;
      left: 0;
      color: white;
      padding: 0.5em;
      background: #17202A;
    }

    a {
      color: #5DADE2;
    }
    a:visited {
      color: #BB8FCE;
    }
  </style>
  <body>
    <div id="app">
      <div class="conveyor-belt-animation">
        <!-- these spans are assigned evenly spaced out animation delays -->
        <!-- the imgs are assigned random rotations -->
        <span class="icon" style="animation-delay: -0.01s;"><img src="./salmon_nigiri.svg" alt="./salmon_nigiri.svg" style="transform: rotate(348deg);"></span>
        <span class="icon" style="animation-delay: -2.14s;"><img src="./tuna_nigiri.svg" alt="./tuna_nigiri.svg" style="transform: rotate(5deg);"></span>
        <span class="icon" style="animation-delay: -4.29s;"><img src="./tuna_rolls.svg" alt="./tuna_rolls.svg" style="transform: rotate(36deg);"></span>
        <span class="icon" style="animation-delay: -6.43s;"><img src="./yellowtail_nigiri.svg" alt="./yellowtail_nigiri.svg" style="transform: rotate(263deg);"></span>
        <span class="icon" style="animation-delay: -8.57s;"><img src="./unagi_nigiri.svg" alt="./unagi_nigiri.svg" style="transform: rotate(143deg);"></span>
        <span class="icon" style="animation-delay: -10.71s;"><img src="./alfonsino_nigiri.svg" alt="./alfonsino_nigiri.svg" style="transform: rotate(127deg);"></span>
        <span class="icon" style="animation-delay: -12.86s;"><img src="./mackerel_nigiri.svg" alt="./mackerel_nigiri.svg" style="transform: rotate(247deg);"></span>
        <span class="icon" style="animation-delay: -15.00s;"><img src="./tuna_rolls.svg" alt="./tuna_rolls.svg" style="transform: rotate(128deg);"></span>
        <span class="icon" style="animation-delay: -17.14s;"><img src="./tofu.svg" alt="./tofu.svg" style="transform: rotate(75deg);"></span>
        <span class="icon" style="animation-delay: -19.29s;"><img src="./salmon_nigiri.svg" alt="./salmon_nigiri.svg" style="transform: rotate(34deg);"></span>
        <span class="icon" style="animation-delay: -21.43s;"><img src="./tuna_nigiri.svg" alt="./tuna_nigiri.svg" style="transform: rotate(136deg);"></span>
        <span class="icon" style="animation-delay: -23.57s;"><img src="./tuna_rolls.svg" alt="./tuna_rolls.svg" style="transform: rotate(121deg);"></span>
        <span class="icon" style="animation-delay: -25.71s;"><img src="./yellowtail_nigiri.svg" alt="./yellowtail_nigiri.svg" style="transform: rotate(61deg);"></span>
        <span class="icon" style="animation-delay: -27.86s;"><img src="./unagi_nigiri.svg" alt="./unagi_nigiri.svg" style="transform: rotate(246deg);"></span>
      </div>

      <div id="footer">
        <div>I created this Conveyor Belt Sushi Animation using CSS animation, SVG icons, and JavaScript interactions! Check out the <a href="https://github.com/harryli0088/conveyor-belt-sushi-animation" target="_blank" rel="noopener noreferrer">Github repo</a>!</div>
      </div>
    </div>

    <script>
      //The conveyor belt animation itself is CSS only. The interactions require JS

      /**
       * given the icon click event, calculate data for the plate pick-up animation
       * @param  {Event} e  the click event
       * @return {Object}   object with fields "iconCenterX", "iconCenterY", "estimatedWaitTime", "transform0", "transform1", "transform2"
       */
      function calculatePlatePickUpData(e) { //manually estimate how long we need to timeout before putting the plate back
        const CSS_ANIMATION_MS = 30000 //set in CSS
        const SCALE = 1.2 //hard coded pick up scale
        const TRANSLATE = 50 //card coded pick up translate distance

        const height = window.innerHeight
        const width = window.innerWidth
        const cssIconRadius = height * 2 / 25 //set in CSS, half of icon size
        const cssOffsetX = height * 3/20 //set in CSS

        //for performance reasons on mobile, use the event clientX and Y instead of getBoundingClientRect
        let iconCenterX = e.clientX //get the center x of the icon
        let iconCenterY = e.clientY //get the center y of the icon
        //getBoundingClientRect in my testing performs poorly on mobile
        //only use it to get the true center of the icon if we're not on mobile
        if(width > 500) { //if the screen width is big enough, it's probably not a phone
          const boundingRect = e.target.getBoundingClientRect() //get the bounding rectangle on the icon
          iconCenterX = boundingRect.left + boundingRect.width/2 //get the center x of the icon
          iconCenterY = boundingRect.top + boundingRect.height/2 //get the center y of the icon
        }
        const sameReturnData = { iconCenterX, iconCenterY }

        const offsetX = iconCenterX - (width / 2) //how far to the left or right from center the icon is
        //how far vertically straight the icons move on the left and right, excluding the bend
        const straightDy = height/2 + cssIconRadius //implied by CSS, since icons are centered, then have a top of 5vh, then move down by half their radius

        const progressY = iconCenterY / straightDy //if <1, the icon is moving on the left or right, else >1 the icon is moving around the bend
        if(progressY < 1) { //if the user clicked on the left or right side
          if(Math.abs(-cssOffsetX - offsetX) <= cssIconRadius) { //if user clicked on the left side
            return {
              ...sameReturnData,
              estimatedWaitTime: (2 - progressY) * CSS_ANIMATION_MS / 2, //wait until the plate is off the screen to make it appear again, simplified from ( 1 - progressY ) * CSS_ANIMATION_MS/2 + CSS_ANIMATION_MS/2
              transform0: ``, //we don't need to do anything here
              transform1: `scale(${SCALE})`, //pick up the plate
              transform2: `translate(-${TRANSLATE}px,0) scale(${SCALE})`, //move the plate away to the left
            }
          }
          else { //else user clicked on the right side
            return {
              ...sameReturnData,
              estimatedWaitTime: progressY * CSS_ANIMATION_MS / 2, //wait until the plate is off the screen to make it appear again
              transform0: `rotate(-180deg)`, //maintain the rotation
              transform1: `scale(${SCALE}) rotate(-180deg)`, //pick up the plate
              transform2: `translate(${TRANSLATE}px,0) scale(${SCALE}) rotate(-180deg)`, //move the plate away to the right
            }
          }
        }

        //else user clicked at the bend
        const offsetY = iconCenterY - straightDy //get boy much vertically into the bend the icon is
        const translateX = TRANSLATE * offsetX / cssOffsetX
        const translateY = TRANSLATE * offsetY / cssOffsetX
        const rotateAngle = -Math.atan(translateX/translateY) * 180 / Math.PI - 90 //we want to maintain the rotation: 0 left, -90 down, -180 right

        return {
          ...sameReturnData,
          estimatedWaitTime: CSS_ANIMATION_MS / 2, //waiting half the animation time is good enough
          transform0: `rotate(${rotateAngle}deg)`, //maintain the rotation
          transform1: `scale(${SCALE}) rotate(${rotateAngle}deg)`, //pick up the plate
          transform2: `translate(${translateX}px,${translateY}px) scale(${SCALE}) rotate(${rotateAngle}deg)`, //move the plate away at the right angle
        }
      }



      const imgs = document.getElementsByTagName("img") //get all the imgs
      for(let i=0; i<imgs.length; ++i) {
        const img = imgs[i]
        img.addEventListener("mousedown", (e) => { //attach on mouse down listeners
          //to make it look like we pick up the plate, we
          //1) make the icon disappear, then make it reappear when it is off screen
          //2) clone the img and put it in new wrapper elements
          //3) transition it at the correct angle like it's being pulled away
          //4) delete the clone and wrappers

          //if the img already has the hidden class, the pointer-events:none rule will prevent this event from firing

          const {
            estimatedWaitTime, //estimate when the plate will be off screen to make it appear again for the next cycle
            iconCenterX,
            iconCenterY,
            transform0,
            transform1,
            transform2,
          } = calculatePlatePickUpData(e)


          //1)
          const imgClone = img.cloneNode(true) //make a clone of the img before we add the hidden class
          img.classList.add("hidden") //make it seem like the plate was taken by the user
          setTimeout(
            () => img.classList.remove("hidden"), //put the plate back on the conveyor belt
            estimatedWaitTime,
          )


          //2)
          const pickedUpPlateContainer = document.createElement("div") //create a plate container element that will set the fixed position and center the inner content
          pickedUpPlateContainer.classList.add("picked-up-plate-container")
          pickedUpPlateContainer.style.top = `${iconCenterY}px`
          pickedUpPlateContainer.style.left = `${iconCenterX}px`

          const pickedUpPlate = document.createElement("div") //create the plate element that will be "animated" using CSS transition
          pickedUpPlate.classList.add("picked-up-plate")
          pickedUpPlate.appendChild(imgClone) //clone the img and append it to the plate

          pickedUpPlateContainer.appendChild(pickedUpPlate) //append the plate to the plate container
          document.getElementById("app").appendChild(pickedUpPlateContainer) //append the plate container to the app


          //3)
          pickedUpPlate.style.transform = transform0 //set the initial transform
          setTimeout(
            () => pickedUpPlate.style.transform = transform1, //set the first transition style
            30, //wait a little so the initial style takes effect, then we can transition to the first transition style
          )
          setTimeout(
            () => { //set the second transition style
              pickedUpPlate.style.transform = transform2
              pickedUpPlate.style.opacity = 0
            },
            500, //0.5s set in CSS
          )


          //4)
          setTimeout(
            () => pickedUpPlateContainer.remove(), //remove the plate container when our animation is done
            1000, //0.5s * 2 = 1s
          )
        })
      }
    </script>
  </body>
</html>
